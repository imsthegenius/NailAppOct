# UX Audit (Mobile) — 2025-10-22

Scope: `nail-app-mobile/` production codebase. This remarks document maps the March 2025 UX audit to the current mobile implementation and adds gaps the original doc did not cover for RN/Expo.

## Summary
- **Overall**: Core flows (Camera → Processing → Results → Feed) are implemented. Supabase auth is wired for saving looks. Salon-grade catalogue UI exists with brand/category filters and pagination.
- **Key gaps**: Theming duplication, onboarding lacks glass primitives, mixed StatusBar/SafeArea usage, web-only CSS in RN styles, hot-pink color usage outside tokens, a legacy screen left in repo, and minor route/type guard risks.

## Implementation Log — 2025-10-22
- Tokenized the hot-pink accent across RN screens (`CameraScreen.tsx`, `ProcessingScreen.tsx`, `ResultsScreen.tsx`, `FeedScreen.tsx`, `StyleScreen.tsx`, `CompareScreen.tsx`, `DeleteAccountScreen.tsx`, `HomeScreen.tsx`, legal content screens) using `useThemeColors()` or `BRAND_COLORS.accent` fallbacks.
- Removed unsupported `backdropFilter` props from `components/ui/GlassmorphicView.tsx` and `screens/CameraScreen.tsx` Android fallbacks.
- Standardized navigation chrome by switching affected screens to Expo `StatusBar` and `react-native-safe-area-context` `SafeAreaView` (auth, onboarding, profile, feed, results, legal, compare, upgrade, etc.).
- Tightened routing by requiring `imageUri` in `RootStackParamList['Results']` and adding a defensive guard in `ResultsScreen.tsx` for unexpected omissions.
- Renamed `assets/images/NailGlowLogo.png` (formerly `Naild Logo.png`) and updated onboarding/splash loaders to align product naming with runtime logging.
- Tried `npm run lint`; command is undefined in the current `package.json`, so no automated lint verification was executed.
- Introduced `src/theme/tokens.ts` as the shared source for colors, gradients, glass, spacing, radii, and typography; refactored `hooks/useColorScheme.ts` and `theme/gradients.ts` to consume the tokens.
- Applied Liquid Glass shells and normalized CTA copy + accessibility hints across the onboarding flow (primary/secondary buttons and continue CTA).
- Added a debounced search bar to `DesignScreen` wired into the existing Supabase catalog filters and surfaced through the glass header.
- Added a persisted cache policy toggle (standard vs compact) to `FeedScreen` and hooked the pruning logic into the selection.
- Defined typed navigation stacks in `navigation/types.ts`, updated main screens to use them, and removed remaining `navigate(... as any)` usages.
- Removed the unused `StyleScreen.tsx` to avoid divergence from the live design flow.
- Added a top-level delete account quick action inside `ProfileScreen` so the flow is reachable within two taps.
- Integrated Sign in with Apple across onboarding and login while removing the unused Google affordance.
- Refreshed the upgrade paywall with compliant Apple subscription copy and disabled state handling during purchase/restore.
- Tightened the `delete-auth-user` edge function CORS controls and added native-client gating via environment config.

## Status vs March 2025 Document (mapped to Mobile)
- **[partially resolved] Persistence mismatch**
  - Looks are persisted with Supabase auth and storage: `nail-app-mobile/screens/ResultsScreen.tsx` uses `supabase.auth.getSession()`, uploads via `uploadImageToSupabase()` and saves via `saveNailLook()` in `nail-app-mobile/lib/supabaseStorage.ts`.
  - Style preferences (selected color/shape/length) live only in Zustand (`nail-app-mobile/src/state/useSelectionStore.ts`) and are not saved to Supabase. No cross-device continuity for selections.
- **[resolved] Salon-grade catalogue**
  - Implemented in `nail-app-mobile/screens/DesignScreen.tsx` with filters (brand, product line, finish, category, swatch, trending), pagination, and category summaries.
  - Backed by `nail-app-mobile/src/services/colorCatalog.ts` (queries `color_catalog_entries`, `color_category_distribution`).
  - Missing a search UI despite API support (`filters.search`).
- **[partially resolved] Processing feedback**
  - Now present on a dedicated `nail-app-mobile/screens/ProcessingScreen.tsx` with progress messaging and animations. The flow blocks until transformation completes (or falls back).
  - Minor: `nail-app-mobile/screens/CameraScreen.tsx` still has an unused `isProcessing` overlay; all processing occurs post-navigate.
- **[resolved] Guard results/profile**
  - `ProcessingScreen` guards missing `imageUri` and navigates back; `ResultsScreen` now adds a defensive guard and redirects if the param is absent.
  - 2025-10-22: `RootStackParamList['Results']` requires `imageUri`, removing the optional type divergence between navigator and screen implementation.

## Cross-App UX/UI Gaps (mobile)
- **[resolved] Theming duplication**
  - `src/theme/tokens.ts` now centralises colors, gradients, glass, spacing, radii, and typography; `useColorScheme` and `theme/gradients.ts` reference the shared tokens.
- **[resolved] Onboarding lacks glass primitives**
  - Onboarding CTAs now use `NativeLiquidGlass` wrappers, tokenised gradients, and refreshed a11y copy.
- **Color inconsistency (hot pink) [high]**
  - `#FF69B4` used in multiple screens: `nail-app-mobile/screens/CameraScreen.tsx` (permission button), `nail-app-mobile/screens/FeedScreen.tsx` (filters, button, spinner), `nail-app-mobile/screens/ProcessingScreen.tsx` (fallback color), `nail-app-mobile/screens/ResultsScreen.tsx` (fallback chip).
  - Should use brand tokens (`accent`/`primary`) from `nail-app-mobile/src/theme/colors.ts` or `useThemeColors()`.
  - **Update 2025-10-22**: All referenced screens now pull accent values from tokens or `useThemeColors()` fallbacks; legal link colors aligned as well.
- **Status bar & safe area divergence [medium]**
  - Expo `StatusBar` in `nail-app-mobile/App.tsx`; RN `StatusBar` in `nail-app-mobile/screens/OnboardingScreen.tsx`.
  - Mixed `SafeAreaView` usage (`react-native` vs `react-native-safe-area-context`) across screens (e.g., `ResultsScreen.tsx` uses RN, `DesignScreen.tsx` uses RNSAC).
  - **Update 2025-10-22**: Swapped affected screens to Expo `StatusBar` + `react-native-safe-area-context` `SafeAreaView` for consistency.
- **Web-only CSS in RN [medium]**
  - `backdropFilter` appears in RN styles and should be removed:
    - `nail-app-mobile/components/ui/GlassmorphicView.tsx` (Android fallback).
    - `nail-app-mobile/screens/CameraScreen.tsx` (`styles.liquidGlassButton`).
  - **Update 2025-10-22**: Removed `backdropFilter` from both files; rely on blur primitives only.
- **Typography/spacing tokens missing [medium]**
  - Sizes/weights are hard-coded across screens. No shared `tokens` for type/spacing.
- **[resolved] Legacy screen**
  - `nail-app-mobile/screens/StyleScreen.tsx` has been removed to prevent drift with the catalog flow.
- **Brand naming mismatch [low]**
  - Log: “NailGlow App Started” (`nail-app-mobile/App.tsx`). Asset: `assets/images/Naild Logo.png`. Align naming (NailGlow vs Naild).
  - **Update 2025-10-22**: Asset renamed to `NailGlowLogo.png`; onboarding and splash screens updated accordingly.
- **ActivityIndicator color inconsistency [low]**
  - Mixed usage: `#e70a5a`, `#FF69B4`, `white`. Centralize via token.
  - **Update 2025-10-22**: Feed loading spinner now uses `theme.accent`; other contexts remain intentionally white or accent for contrast.

## Additional UX/Performance Findings (not in March doc)
- **Cache growth risk [medium]**
  - `nail-app-mobile/screens/FeedScreen.tsx` caches images up to `MAX_CACHE_FILES = 80`, `MAX_CACHE_BYTES = 120 MB`. Consider telemetry and an in-app setting or lower bounds for low-storage devices.
  - **Update 2025-10-22**: Added a persisted cache policy toggle (standard vs compact) that also re-prunes the cache to the selected limits.
- **Type safety route gaps [low]**
  - Several `navigation.navigate(... as any)` calls (e.g., `CameraScreen.tsx`, `DesignScreen.tsx`) reduce type safety and can hide param shape issues.
  - **Update 2025-10-22**: Introduced typed root/main stack definitions and removed the `as any` navigation calls in active flows.
- **Default color fallbacks [low]**
  - `ProcessingScreen.tsx` and others default to `#FF69B4` or generic “Pink” when `selectedColor` is unset. Prefer tokenized accent or require a selection step.
  - **Update 2025-10-22**: All fallbacks now rely on the accent token derived from the theme.

## Recommendations & Fix Plan
- **Phase 1: Quick consistency fixes (1–2 hrs)**
  - Replace `#FF69B4` usages with tokens from `useThemeColors()` or `BRAND_COLORS`.
  - Remove `backdropFilter` from RN styles in `GlassmorphicView.tsx` and `CameraScreen.tsx`.
  - Standardize on Expo `StatusBar` and `react-native-safe-area-context` `SafeAreaView` across screens.
  - Tighten `RootStackParamList['Results']` so `imageUri` is required; add guard in `ResultsScreen.tsx` for unexpected absence.
- **Phase 2: Theming unification (0.5–1 day)**
  - Create `nail-app-mobile/src/theme/tokens.ts`: colors, gradients, glass, spacing, radii, typography.
  - Make `theme/gradients.ts` a thin map to tokens; refactor `hooks/useColorScheme.ts` to consume tokens; remove duplicates.
- **Phase 3: Onboarding polish (0.5 day)**
  - Apply `NativeLiquidGlass`/`GlassmorphicView` to CTAs and surfaces.
  - Normalize CTA copy and a11y labels; adopt tokenized colors.
- **Phase 4: Structure & UX (2–4 hrs)**
  - Decide fate of `StyleScreen.tsx` (remove or align with `DesignScreen` patterns and wire into nav).
  - Optional: add search UI to `DesignScreen` (API already supports `filters.search`).
  - Review cache thresholds in `FeedScreen.tsx` and expose telemetry or a setting.

## Acceptance Criteria
- **Theming**: Single token source; no direct hard-coded colors/gradients outside tokens.
- **Glass**: Onboarding CTAs use glass primitives; Android fallback avoids web-only props — ✅ updated 2025-10-22.
- **Colors**: No `#FF69B4` in RN screens; all spinners/accents use token — ✅ updated 2025-10-22.
- **Status Bar & Safe Area**: Expo `StatusBar` only; RNSAC `SafeAreaView` in all applicable screens — ✅ updated 2025-10-22.
- **Cleanup**: No `backdropFilter` in RN; `StyleScreen` decision documented; brand name consistent — ✅ updated 2025-10-22 (StyleScreen removed).
- **Routing**: `Results` requires `imageUri`; screen guards against missing data — ✅ updated 2025-10-22.

## Code references
- Tokens: `nail-app-mobile/src/theme/colors.ts`, `nail-app-mobile/hooks/useColorScheme.ts`, `nail-app-mobile/theme/gradients.ts`
- Onboarding: `nail-app-mobile/screens/OnboardingScreen.tsx`
- Camera delay (50ms): `nail-app-mobile/screens/CameraScreen.tsx`
- Processing: `nail-app-mobile/screens/ProcessingScreen.tsx`
- Results: `nail-app-mobile/screens/ResultsScreen.tsx`
- Glass primitives: `nail-app-mobile/components/ui/NativeLiquidGlass.tsx`, `nail-app-mobile/components/ui/GlassmorphicView.tsx`, `nail-app-mobile/components/ui/LiquidGlassTabBar.tsx`
- Catalogue: `nail-app-mobile/screens/DesignScreen.tsx`, `nail-app-mobile/src/services/colorCatalog.ts`
- Feed cache: `nail-app-mobile/screens/FeedScreen.tsx`
- Navigation: `nail-app-mobile/navigation/MainNavigator.tsx`, `nail-app-mobile/App.tsx`

## Checklist
- [x] Replace non-token colors with tokens (accent/primary) across screens
- [x] Remove `backdropFilter` from RN styles in `GlassmorphicView` and `CameraScreen`
- [x] Standardize `StatusBar` usage (Expo) and Safe Area (RNSAC)
- [x] Introduce unified tokens: colors, gradients, glass, spacing, radii, typography
- [x] Apply Liquid Glass on onboarding CTAs and surfaces
- [x] Normalize CTA labels & a11y labels in onboarding/auth
- [x] Decide/remove or align `StyleScreen` and navigation
- [x] Align brand naming and logo asset
- [x] Make `Results` route param required and add guard
- [x] Optional: Add search UI to `DesignScreen`
